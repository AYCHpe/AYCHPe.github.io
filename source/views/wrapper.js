var html = require('choo/html')

var Form = require('../components/form-mailinglist')
var views = require('.')

var form = new Form()

module.exports = wrapper

function wrapper (state, emit) {
  if (!state.site.loaded) return createLoading()
  var page = getPage()
  var view = getView()
  var colors = getColors()

  return html`
    <body class="ff-sans lh1-5 fs1 ${colors}">
      ${view(state, emit)}
      ${state.query.subscribe ? createSubscribe() : ''}
    </body>
  `

  function getPage () {
    var page = state.content[state.href || '/'] || { }
    return page.redirect
      ? state.content[page.redirect || '/'] || { }
      : page
  }

  function getView () {
    return views[page.view] || views.default
  }

  function getColors () {
    return page.invert === true
      ? 'bgc-black fc-white'
      : 'bgc-white fc-black'
  }
}

function createSubscribe () {
  return html`
    <div class="psf t0 l0 r0 b0 x xjc xac p1 img-grid" style="z-index: 99">
      <a href="?" class="db psa t0 l0 r0 b0"></a>
      <div class="psr z2 c12 sm-c6">
        ${form.render()}
      </div>
    </div>
  `
}

function createLoading () {
  return html`
    <body>
      <svg class="title-loading" width="1566px" height="508px" viewBox="0 0 1566 508">
        <g fill="#000">
          <path d="M0,201.976036 L0,0 L64.5201226,0 C112.489431,0 133.248079,30.5769277 133.248079,61.4343776 C133.248079,92.2918276 112.489431,122.307711 64.5201226,122.307711 L22.1612595,122.307711 L22.1612595,201.976036 L0,201.976036 Z M22.1612595,104.354285 L64.5201226,104.354285 C100.988018,104.354285 111.08682,82.473548 111.08682,61.4343776 C111.08682,38.7120736 100.988018,17.9534254 64.5201226,17.9534254 L22.1612595,17.9534254 L22.1612595,104.354285 Z M208.272203,205.622826 C167.596473,205.622826 143.471558,174.204331 143.471558,131.284423 C143.471558,87.2424267 172.365352,58.0681103 208.272203,58.0681103 C244.179053,58.0681103 272.231281,88.0839935 271.109192,136.333824 L163.949684,136.333824 C164.79125,164.105529 181.622587,188.791489 208.552725,188.791489 C230.713984,188.791489 243.898531,173.362764 248.66741,158.495084 L268.023447,162.141873 C262.132479,182.900521 243.618009,205.622826 208.272203,205.622826 Z M165.071773,120.344055 L249.789499,120.344055 C248.386887,94.2554835 230.713984,74.6189244 208.272203,74.6189244 C186.391465,74.6189244 168.157518,93.4139166 165.071773,120.344055 Z M361.156841,205.622826 C320.481111,205.622826 296.356196,174.204331 296.356196,131.284423 C296.356196,87.2424267 325.24999,58.0681103 361.156841,58.0681103 C397.063692,58.0681103 425.115919,88.0839935 423.99383,136.333824 L316.834322,136.333824 C317.675889,164.105529 334.507225,188.791489 361.437363,188.791489 C383.598623,188.791489 396.783169,173.362764 401.552048,158.495084 L420.908085,162.141873 C415.017117,182.900521 396.502647,205.622826 361.156841,205.622826 Z M317.956411,120.344055 L402.674137,120.344055 C401.271526,94.2554835 383.598623,74.6189244 361.156841,74.6189244 C339.276104,74.6189244 321.042156,93.4139166 317.956411,120.344055 Z M456.534413,201.976036 L456.534413,61.7148999 L473.926794,61.7148999 L475.89045,86.1203376 L476.451495,86.1203376 C484.025596,68.4474344 500.015366,58.0681103 516.285657,58.0681103 C524.981848,58.0681103 533.116994,60.0317663 537.324828,62.5564667 L537.324828,78.2657139 C533.116994,76.5825803 525.823415,74.8994467 517.127224,74.8994467 C494.965965,74.8994467 476.732017,90.8892162 476.732017,133.248079 L476.732017,201.976036 L456.534413,201.976036 Z M562.790016,136.614347 L562.790016,116.697265 L637.408941,116.697265 L637.408941,136.614347 L562.790016,136.614347 Z M714.833088,203.65917 C691.269217,203.65917 677.523626,192.438279 677.523626,161.300307 L677.523626,78.5462362 L651.154532,78.5462362 L651.154532,61.7148999 L677.523626,61.7148999 L677.523626,30.5769277 L697.721229,30.5769277 L697.721229,61.7148999 L729.420246,61.7148999 L729.420246,78.5462362 L697.721229,78.5462362 L697.721229,161.861351 C697.721229,179.814776 703.331675,186.827833 716.516221,186.827833 C721.846145,186.827833 728.017635,186.266789 733.347558,185.1447 L733.347558,200.573425 C730.542335,201.976036 721.004578,203.65917 714.833088,203.65917 Z M816.101628,205.622826 C776.267465,205.622826 749.61785,173.923809 749.61785,132.406512 C749.61785,90.3281716 776.267465,58.0681103 816.101628,58.0681103 C855.935791,58.0681103 882.585407,90.3281716 882.585407,132.406512 C882.585407,173.923809 855.935791,205.622826 816.101628,205.622826 Z M816.101628,188.791489 C843.031766,188.791489 862.387803,162.702918 862.387803,132.406512 C862.387803,100.988018 843.031766,74.8994467 816.101628,74.8994467 C786.366267,74.8994467 769.815453,100.988018 769.815453,132.406512 C769.815453,162.702918 786.64679,188.791489 816.101628,188.791489 Z M910.637634,136.614347 L910.637634,116.697265 L985.256558,116.697265 L985.256558,136.614347 L910.637634,136.614347 Z M1028.67517,201.976036 L1028.67517,0 L1093.19529,0 C1141.1646,0 1161.92325,30.5769277 1161.92325,61.4343776 C1161.92325,92.2918276 1141.1646,122.307711 1093.19529,122.307711 L1050.83643,122.307711 L1050.83643,201.976036 L1028.67517,201.976036 Z M1050.83643,104.354285 L1093.19529,104.354285 C1129.66319,104.354285 1139.76199,82.473548 1139.76199,61.4343776 C1139.76199,38.7120736 1129.66319,17.9534254 1093.19529,17.9534254 L1050.83643,17.9534254 L1050.83643,104.354285 Z M1236.94737,205.622826 C1196.27165,205.622826 1172.14673,174.204331 1172.14673,131.284423 C1172.14673,87.2424267 1201.04052,58.0681103 1236.94737,58.0681103 C1272.85423,58.0681103 1300.90645,88.0839935 1299.78436,136.333824 L1192.62486,136.333824 C1193.46642,164.105529 1210.29776,188.791489 1237.2279,188.791489 C1259.38916,188.791489 1272.5737,173.362764 1277.34258,158.495084 L1296.69862,162.141873 C1290.80765,182.900521 1272.29318,205.622826 1236.94737,205.622826 Z M1193.74694,120.344055 L1278.46467,120.344055 C1277.06206,94.2554835 1259.38916,74.6189244 1236.94737,74.6189244 C1215.06664,74.6189244 1196.83269,93.4139166 1193.74694,120.344055 Z M1389.83201,205.622826 C1349.15628,205.622826 1325.03137,174.204331 1325.03137,131.284423 C1325.03137,87.2424267 1353.92516,58.0681103 1389.83201,58.0681103 C1425.73886,58.0681103 1453.79109,88.0839935 1452.669,136.333824 L1345.50949,136.333824 C1346.35106,164.105529 1363.1824,188.791489 1390.11254,188.791489 C1412.27379,188.791489 1425.45834,173.362764 1430.22722,158.495084 L1449.58326,162.141873 C1443.69229,182.900521 1425.17782,205.622826 1389.83201,205.622826 Z M1346.63158,120.344055 L1431.34931,120.344055 C1429.9467,94.2554835 1412.27379,74.6189244 1389.83201,74.6189244 C1367.95128,74.6189244 1349.71733,93.4139166 1346.63158,120.344055 Z M1485.20959,201.976036 L1485.20959,61.7148999 L1502.60197,61.7148999 L1504.56562,86.1203376 L1505.12667,86.1203376 C1512.70077,68.4474344 1528.69054,58.0681103 1544.96083,58.0681103 C1553.65702,58.0681103 1561.79217,60.0317663 1566,62.5564667 L1566,78.2657139 C1561.79217,76.5825803 1554.49859,74.8994467 1545.8024,74.8994467 C1523.64114,74.8994467 1505.40719,90.8892162 1505.40719,133.248079 L1505.40719,201.976036 L1485.20959,201.976036 Z M189.586302,482.498308 L132.920803,280.522272 L157.326241,280.522272 L203.331894,455.848692 L204.734505,455.848692 L252.984336,280.522272 L281.036563,280.522272 L326.761693,455.287648 L327.883782,455.287648 L376.414136,280.522272 L399.978006,280.522272 L341.068329,482.498308 L313.016102,482.498308 L267.571494,306.049799 L265.88836,306.049799 L217.077485,482.498308 L189.586302,482.498308 Z M467.926735,486.145098 C427.251005,486.145098 403.12609,454.726603 403.12609,411.806696 C403.12609,367.764699 432.019884,338.590383 467.926735,338.590383 C503.833585,338.590383 531.885813,368.606266 530.763724,416.856096 L423.604216,416.856096 C424.445782,444.627801 441.277119,469.313761 468.207257,469.313761 C490.368516,469.313761 503.553063,453.885036 508.321942,439.017356 L527.677979,442.664146 C521.787011,463.422794 503.272541,486.145098 467.926735,486.145098 Z M424.726305,400.866327 L509.444031,400.866327 C508.04142,374.777756 490.368516,355.141197 467.926735,355.141197 C446.045997,355.141197 427.81205,373.936189 424.726305,400.866327 Z M629.788086,486.145098 C607.907348,486.145098 592.759146,476.326818 583.501911,461.73966 L582.940866,461.73966 L580.696688,482.498308 L563.304307,482.498308 L563.304307,280.522272 L583.501911,280.522272 L583.501911,362.99582 L584.062955,362.99582 C593.881235,347.567095 608.468393,338.590383 630.068608,338.590383 C663.731281,338.590383 689.819852,370.008877 689.819852,411.806696 C689.819852,451.360336 665.133892,486.145098 629.788086,486.145098 Z M626.421818,469.313761 C654.193523,469.313761 669.341726,444.627801 669.341726,411.806696 C669.341726,381.51029 654.193523,355.141197 626.421818,355.141197 C597.528024,355.141197 582.379822,380.949246 582.660344,411.806696 C582.940866,444.627801 597.528024,469.313761 626.421818,469.313761 Z M778.745412,506.623224 L864.86575,280.802794 L880.294475,280.802794 L794.454659,506.623224 L778.745412,506.623224 Z" id="title" fill-rule="nonzero"/>
          <polygon class="title-blink" points="954.913399 507.184268 954.913399 492.036065 1406.63219 492.036065 1406.63219 507.184268"/>
        </g>
      </svg>
    </body>
  `
}
